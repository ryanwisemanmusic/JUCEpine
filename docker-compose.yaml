services:
  juce-builder:
    build: .
    platform: linux/amd64
    user: builder
    environment:
      PACKAGER_NAME: "Ryan Wiseman"
      PACKAGER_EMAIL: "ryanwisemanmusic@gmail.com"
      BUILDER_HOME: "/home/builder"
      REPODEST: "/home/builder/packages"
    volumes:
      - ./keys:/home/builder/.abuild
      - ./distfiles:/var/cache/distfiles
      - ./packages:/home/builder/packages
    command: >
      /bin/bash -c "
        echo '=== Building JUCE Package ===' &&
        ./build-setup.sh &&
        echo '' &&
        echo '=== Installing JUCE Package ===' &&
        doas apk add --allow-untrusted /home/builder/packages/home/x86_64/juce-7.0.8-r*.apk &&
        echo '' &&
        /bin/bash /home/builder/test-compile.sh
      "